(()=>{var At=Object.defineProperty;var Rt=(i,t,e)=>t in i?At(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var h=(i,t,e)=>(Rt(i,typeof t!="symbol"?t+"":t,e),e);var R={_inherit:function(i){i._getEvents=this._getEvents,i.on=this.on,i.once=this.once,i.removeListener=this.removeListener,i.emit=this.emit},_getEvents:function(){var i=this.events;return i||(this.events=i={})},on:function(i,t){var e=this,o=e._getEvents()[i];return o||(o=e.events[i]=[]),o.push(t),this},once:function(i,t){var e=this;e.on(i,function o(){if(e.removeListener(i,o))return t.apply(this,arguments)})},removeListener:function(i,t){var e=this,o=e._getEvents()[i];if(o){var n=o.indexOf(t);if(n>=0)return o.splice(n,1),!0}return!1},emit:function(){var i=this,t=arguments[0],e=Array.prototype.slice.call(arguments,1),o=this._getEvents()[t];o&&o.forEach(n=>{n.apply(i,e)})}};Array.prototype.forEach||(Array.prototype.forEach=function(i,t){var e,o;if(this===null)throw new TypeError("this is null or not defined");var n=Object(this),c=n.length>>>0;if({}.toString.call(i)!="[object Function]")throw new TypeError(i+" is not a function");for(t&&(e=t),o=0;o<c;){var u;o in n&&(u=n[o],i.call(e,u,o,n)),o++}});Array.prototype.remove=function(i){var t=this.indexOf(i);return t>=0?this.splice(t,1):null};Array.prototype.insertBefore=function(i,t){var e=this.indexOf(t);if(e<0)throw"insertBefore: before not found";this.splice(e,0,i)};Array.prototype.insertAfter=function(i,t){var e=this.indexOf(t);if(e<0)throw"insertAfter: after not found";this.splice(e+1,0,i)};Array.prototype.sample=function(){return this[Math.floor(this.length*Math.random())]};Array.prototype.max=function(){return Math.max.apply(Math,array)};Array.prototype.min=function(){return Math.min.apply(Math,array)};Array.prototype.maxF=function(i){return this.reduce((t,e)=>t===void 0||i(t,e)<0?e:t,void 0)};Array.prototype.minF=function(i){return this.reduce((t,e)=>t===void 0||i(t,e)>0?e:t,void 0)};Array.prototype.contains=function(i){return this.indexOf(i)!==-1};Array.prototype.compact=function(){return this.filter(i=>i!=null)};Object.prototype.merge=function(i,t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])};Object.values=function(i){var t=[];for(var e in i)i.hasOwnProperty(e)&&t.push(i[e]);return t};Object.keys=function(i){var t=[];for(var e in i)i.hasOwnProperty(e)&&t.push(e);return t};Boolean.prototype.toNumber=function(){return this?1:0};Math.rnd=function(){return(Math.random()-.5)*2};Math.clamp=function(i,t,e){return Math.max(t,Math.min(e,i))};Math.sign=function(i){return i===0?0:i<0?-1:1};Math.easeInOutCubic=function(i){return i/=1/2,i<1?1/2*i*i*i:(i-=2,1/2*(i*i*i+2))};Math.easeOutQuad=function(i){return-1*i*(i-2)};var $={};R._inherit($);(function(){var i=!1;function t(){i||(i=!0,$.emit("load"))}if(document.addEventListener&&document.addEventListener("DOMContentLoaded",t,!1),/KHTML|WebKit|iCab/i.test(navigator.userAgent))var e=setInterval(()=>{/loaded|complete/i.test(document.readyState)&&(t(),clearInterval(e))},10);window.onload=t})();var tt=$;var V=class{constructor(t){this.root=null,this._nextProp=Symbol("_next"+t)}push(t){if(this._nextProp in t)throw typeof t+" "+t.constructor+" already in list "+this._nextProp;t[this._nextProp]=this.root,this.root=t}pop(){if(!(this._nextProp in t))throw typeof t+" "+t.constructor+" not in list "+this._nextProp;let t=this.root;return this.root=t[this._nextProp],t}each(t){let e=this.root;if(!e)return;let o=null,n;for(;e;){n=e[this._nextProp];let c=t(e,V.BREAK,V.DELETE);if(c===V.DELETE){o?o[this._nextProp]=n:this.root=n,delete e[this._nextProp],e=n;continue}else if(c===V.BREAK)break;o=e,e=n}}*iterate(){let t=this.root;if(!t)return;let e=null,o;for(;t;)o=t[this._nextProp],yield t,e=t,t=o}[Symbol.iterator](){return this.iterate()}contains(t){let e=!1;return this.each((o,n)=>{if(o===t)return e=!0,n}),e}},W=V;h(W,"BREAK",Symbol("BREAK")),h(W,"DELETE",Symbol("DELETE"));var H=W;"use strict";var k=class{constructor(t){this.root=null,this.tail=null,this._nextProp=Symbol("_next"+t),this._prevProp=Symbol("_prev"+t),this.listeners={added:[],removed:[]}}get first(){return this.root}push(t){if(this._nextProp in t)throw typeof t+" "+t.constructor+" already in list "+this._nextProp;let e=this.root;e&&(e[this._prevProp]=t),t[this._nextProp]=e,t[this._prevProp]=null,this.root=t,this.tail||(this.tail=t),this.each(function(o){if(o[this._nextProp]===o)throw"koek"});for(let o of this.listeners.added)o(t)}pop(){this.remove(this.root)}remove(t){if(!(this._nextProp in t))throw typeof t+" "+t.constructor+" not in list "+this._nextProp;let e=t[this._prevProp],o=t[this._nextProp];this.root===t?this.root=o:e[this._nextProp]=o,o&&(this.tail=e,o[this._prevProp]=e),delete t[this._nextProp],delete t[this._prevProp];for(let n of this.listeners.removed)n(t)}each(t){let e=this.root;if(!e)return;let o;for(;e;){o=e[this._nextProp];let n=t.call(this,e,k.BREAK,k.DELETE);if(n===k.DELETE){this.remove(e),e=o;continue}else{if(n===k.BREAK)break;e=o}}}*iterate(){let t=this.root;if(!t)return;let e;for(;t;)e=t[this._nextProp],yield t,t=e}[Symbol.iterator](){return this.iterate()}eachReverse(t){let e=this.tail;if(!e)return;let o;for(;e;){o=e[this._prevProp];let n=t(e,k.BREAK,k.DELETE);if(n===k.DELETE){this.remove(e),e=o;continue}else{if(n===k.BREAK)break;e=o}}}insertBefore(t,e){let o=t&&t[this._prevProp],n=t;e[this._nextProp]=n,e[this._prevProp]=o,n&&(n[this._prevProp]=e),o?o[this._nextProp]=e:this.root=e;for(let c of this.listeners.added)c(e)}},q=k;h(q,"DELETE",Symbol("DELETE")),h(q,"BREAK",Symbol("BREAK"));var Q=q;function et(){var i=this;this.lists={},this.objects=new Q("object"),this.named={},this.pendingAdd=new H("pendingAdd"),this.pendingRemove=new H("pendingRemove")}var F=et.prototype;F.add=function(i){this.pendingAdd.push(i)};F.createIndexList=function(i){var t=new Q(i);return t.property=i,t};F.remove=function(i){this.pendingRemove.contains(i)||this.pendingRemove.push(i)};F.clear=function(i){var t=this;t.handlePending();for(let e of t.objects)t.remove(e);t.handlePending()};F.handlePending=function(){var i=this;i.pendingAdd.root,i.pendingAdd.each((t,e,o)=>{console.assert(!t._objectmanager),t._objectmanager=i,i.objects.push(t);for(var n in i.lists)(t[i.lists[n].property]||t.constructor[i.lists[n].property])&&i.lists[n].push(t);if(t.name){if(i.named[t.name])throw"Another object with the same name was already added.";i.named[t.name]=t}return o}),i.pendingRemove.each((t,e,o)=>{delete t.__pendingRemove,console.assert(t._objectmanager===i),t._objectmanager=null,i.objects.remove(t);for(var n in i.lists)(t[i.lists[n].property]||t.constructor[i.lists[n].property])&&i.lists[n].remove(t);return t.name&&delete i.named[t.name],o})};var it=et;function st(i){this.context=i}var x=st.prototype;x.resizeCanvas=function(){this.context.canvas.width=window.innerWidth,this.context.canvas.height=window.innerHeight};x.clear=function(){this.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,9e3,9e3),this.restore()};x.fillStyle=function(i){if(i)this.context.fillStyle=i;else return i};x.strokeStyle=function(i){if(i)this.context.strokeStyle=i;else return i};x.font=function(i){this.context.font=i};x.circle=function(i,t,e){this.context.beginPath(),this.context.arc(i,t,e,0,Math.PI*2,!0),this.context.closePath()};x.rectangle=function(i,t,e,o){this.context.rect(i,t,e,o)};x.polygon=function(i){if(this.context.beginPath(),i.length>0){this.context.moveTo(i[0].x,i[0].y);for(var t=1;t<i.length;t++)this.context.lineTo(i[t].x,i[t].y)}this.context.closePath()};x.strokePolygon=function(i){this.polygon(i),this.context.stroke()};x.fillPolygon=function(i){this.polygon(i),this.context.fill()};x.strokeRectangle=function(i,t,e,o){this.context.strokeRect(i,t,e,o)};x.fillRectangle=function(i,t,e,o){this.context.fillRect(i,t,e,o)};x.strokeCircle=function(i,t,e){this.circle(i,t,e),this.context.stroke()};x.fillCircle=function(i,t,e){this.circle(i,t,e),this.context.fill()};x.fillLoading=function(i,t,e,o){var n=this.context,c=(o*360-90)*(Math.PI/180),u=(0-90)*(Math.PI/180);n.beginPath(),n.moveTo(i,t),n.lineTo(i+Math.cos(c)*e,t+Math.sin(c)*e),n.arc(i,t,e,c,u,!1),n.lineTo(i,t),n.closePath(),n.fill()};x.shadow=function(i,t,e,o,n){this.context.shadowColor=i,this.context.shadowBlur=t,this.context.shadowOffsetX=e,this.context.shadowOffsetY=o,n(),this.context.shadowColor="",this.context.shadowBlur=0,this.context.shadowOffsetX=0,this.context.shadowOffsetY=0};x.line=function(i,t,e,o){this.context.beginPath(),this.context.moveTo(i,t),this.context.lineTo(e,o),this.context.closePath()};x.strokeLine=function(i,t,e,o){this.line(i,t,e,o),this.context.stroke()};x.translate=function(i,t,e){this.save(),this.context.translate(i,t),e(),this.restore()};x.rotate=function(i,t,e,o){this.save(),this.context.translate(i,t),this.context.rotate(e),this.context.translate(-i,-t),o(),this.restore()};x.scale=function(i,t,e,o,n){this.save(),this.context.translate(i,t),this.context.scale(e,o),this.context.translate(-i,-t),n(),this.restore()};x.scalerotate=function(i,t,e,o,n,c){this.save(),this.context.translate(i,t),this.context.rotate(n),this.context.scale(e,o),this.context.translate(-i,-t),c(),this.restore()};x.drawImage=function(i,t,e,o,n,c,u,m,g){i&&this.context.drawImage.apply(this.context,arguments)};x.drawCenteredImage=function(i,t,e){i&&this.context.drawImage(i,t-i.width/2,e-i.height/2)};x.fillCenteredText=function(i,t,e){var o=this.context.measureText(i);this.context.fillText(i,t-o.width/2,e)};x.fillText=function(i,t,e){this.context.fillText(i,t,e)};x.save=function(){this._depth||(this._depth=0),this._depth++,this.context.save()};x.restore=function(){if(this._depth<=0)throw console.log("NOES"),"NOES";this.context.restore(),this._depth--};var ot=st;function nt(i,t){function e(o,n){if(o<i.length){var c=i[o],u=[function(){return e(o+1,arguments)}];return Array.prototype.unshift.apply(u,n),c.apply(null,u)}else return t.apply(null,n)}return function(){e(0,arguments)}}function rt(i,t,e){var o=this;this.objects=new it,this.objects.lists.update=this.objects.createIndexList("updatable"),this.objects.lists.draw=this.objects.createIndexList("drawable"),this.chains={draw:[],update:[]},this.chains.draw.push(this.chains.draw.objects=function(u,m){for(let g of o.objects.lists.draw)g.draw(u);m(u)}),this.chains.update.push(this.chains.update.objects=function(m,g){for(let v of o.objects.lists.update)v.update(m);o.objects.handlePending(),g(m)}),this.canvas=t,this.graphics=new ot(t.getContext("2d",{alpha:!1})),this.time=0;var n=0;e.forEach(u=>{var m=u(o,c);m!==c&&c()});function c(){n++,n===e.length&&setTimeout(i,0)}this.components=e}var z=rt.prototype;R._inherit(z);Object.defineProperty(z,"width",{get:function(){return this.canvas.width}});Object.defineProperty(z,"height",{get:function(){return this.canvas.height}});z.start=function(){if(this.isRunning)throw"Already started";var i=this,t={};i.time=0,i.running=t,this.canvas.setAttribute("tabIndex","0"),this.canvas.focus(),this.canvas.oncontextmenu=function(){return!1};var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,1e3/60)},o=new Date().getTime();e(n);function n(){var c=new Date().getTime(),u=(c-o)/1e3;o=c,u=1/60,nt(i.chains.update,m=>{})(u),i.time+=u,i.canvas.width=i.canvas.parentElement.clientWidth,i.canvas.height=i.canvas.parentElement.clientHeight,i.graphics.clear(),nt(i.chains.draw,m=>{})(i.graphics),i.running===t&&e(n)}};z.stop=function(){delete this.running};var at=rt;var C=class{constructor(t,e){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}add(t,e){return this.x+=t,this.y+=e,this}substract(t,e){return this.x-=t,this.y-=e,this}multiply(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t,this.y/=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}length2(){return this.x*this.x+this.y*this.y}distanceTo(t,e){var o=this.x-t;o*=o;var n=this.y-e;return n*=n,Math.sqrt(o+n)}normalize(){var t=this.length();if(t===0)throw"Normalizing 0!";return this.x/=t,this.y/=t,this}normalizeOr(t,e){var o=this.length();return o===0?(this.x=t,this.y=e,this):(this.x/=o,this.y/=o,this)}normalizeOrZero(){return this.normalizeOr(0,0)}dot(t,e){return this.x*t+this.y*e}negate(){return this.x=-this.x,this.y=-this.y,this}normalRight(){var t=this.x;return this.x=-this.y,this.y=t,this}normalLeft(){var t=this.x;return this.x=this.y,this.y=-t,this}equals(t,e){return this.x===t&&this.y===e}toString(){return"Vector("+this.x+","+this.y+")"}rotate(t){var e=this.length(),o=Math.atan2(this.y,this.x)+t;return this.x=Math.cos(o)*e,this.y=Math.sin(o)*e,this}angleToward(t,e){var o=Math.atan2(this.y,this.x),n=Math.atan2(e,t);return o<-Math.PI/2&&n>Math.PI/2&&(o+=Math.PI*2),n<-Math.PI/2&&o>Math.PI/2&&(n+=Math.PI*2),n-o}angle(){return Math.atan2(this.y,this.x)}clone(){return new C(this.x,this.y)}setV(t){return this.set(t.x,t.y)}addV(t){return this.add(t.x,t.y)}substractV(t){return this.substract(t.x,t.y)}multiplyV(t){return this.multiply(t.x,t.y)}divideV(t){return this.divide(t.x,t.y)}normalizeOrV(t){return this.normalizeOr(t.x,t.y)}dotV(t){return this.dot(t.x,t.y)}equalsV(t){return this.equals(t.x,t.y)}distanceToV(t){return this.distanceTo(t.x,t.y)}angleTowardV(t){return this.angleToward(t.x,t.y)}static distance(t,e,o,n){var c=t-o;c*=c;var u=e-n;return u*=u,Math.sqrt(c+u)}},D=C;h(D,"zero",new C(0,0)),h(D,"xaxis",new C(1,0)),h(D,"yaxis",new C(0,1));var w=D;function ht(i){return i.state=null,i.changeState=function(t){this.state&&this.state.disable(),this.state=t,this.state&&this.state.enable()},{create:function(t){}}}var lt=class{constructor({game:t}){h(this,"level",null);this.game=t}changeLevel(t){if(this.level){for(let e of this.game.objects.objects)this.game.objects.remove(e);this.level.disable&&this.level.disable()}if(this.game.objects.handlePending(),this.game.emit("levelunloaded"),this.level=t,this.level){for(let e of this.level.objects)this.game.objects.add(e);this.level.enable&&this.level.enable()}this.game.objects.handlePending(),this.game.emit("levelchanged")}restartLevel(){this.changeLevel(this.level.clone())}hasNextLevel(t){let e=t||this.level;return e&&e.nextLevel}nextLevel(t){let e=(t||this.level).nextLevel();this.changeLevel(e)}},ct=lt;function dt(i){i.objects.lists.collide=i.objects.createIndexList("collide"),i.objects.lists.collidable=i.objects.createIndexList("collidable"),i.on("postupdate",()=>{i.emit("precollision"),t(),i.emit("postcollision")});function t(){var e=new w(0,0),o=new w(0,0),n=[];for(let v of i.objects.lists.collidable)n=n.concat(v.collisionlines);for(let v of i.objects.lists.collide){if(!v.velocity)return;v.surfaces=[];for(var c=0;c<5;c++){let b=function(P){for(var j=0;j<P.length;j++){var y=P[j];if(!(y.normal.dotV(v.velocity)>0)){e.setV(y.normal),e.normalRight();var _=y.start.distanceToV(y.end);o.setV(v.position),o.substractV(y.start);var L=y.normal.dotV(o)-v.collisionRadius,M=e.dotV(o);if(!(L<-v.collisionRadius*2))if(L<0){var A;M>0&&M<_?(L*=-1,u.push({lineSegment:y,offset:L})):M<0&&M>-v.collisionRadius?(A=v.position.distanceToV(y.start),A<v.collisionRadius&&(e.setV(v.position),e.substractV(y.start),e.normalize(),u.push({lineSegment:y,offset:v.collisionRadius-A}))):M>_&&M<_+v.collisionRadius&&(A=v.position.distanceToV(y.end),A<v.collisionRadius&&(e.setV(v.position),e.substractV(y.end),e.normalize(),u.push({lineSegment:y,offset:v.collisionRadius-A})))}else continue}}};var u=[];if(b(n),u.length>0){u.sort((P,j)=>j.offset-P.offset);var m=u[0];v.position.add(m.lineSegment.normal.x*m.offset,m.lineSegment.normal.y*m.offset);var g=v.velocity.dotV(m.lineSegment.normal);v.velocity.substract(m.lineSegment.normal.x*g,m.lineSegment.normal.y*g),v.surfaces.push(m),v.collide(m)}else{v.surface=null;break}}}}}var K={27:"escape",32:"space",38:"up",40:"down",39:"right",37:"left",13:"enter",16:"shift",219:"[",221:"]"},I;for(I=0;I<27;I++)K[I+65]=String.fromCharCode(I+97);for(I=0;I<10;I++)K[I+48]=String.fromCharCode(I+48);function ut(i){i.keys={},i.canvas.addEventListener("keyup",t=>{var e=K[t.keyCode];e&&(i.keys[e]&&(delete i.keys[e],i.emit("keyup",e)),t.preventDefault())},!0),i.canvas.addEventListener("keydown",t=>{var e=K[t.keyCode];e&&(i.keys[e]||(i.keys[e]=!0,i.emit("keydown",e)),t.preventDefault())},!0)}function mt(){return(Math.random()-.5)*2}function ft(i){function t(e,o){t.step=o/e,t.magnitude=o}i.chains.draw.unshift((e,o)=>{e.save(),e.context.translate(mt()*t.magnitude,mt()*t.magnitude),o(e),e.restore()}),i.chains.update.unshift((e,o)=>{t.magnitude>0&&(t.magnitude-=t.step*e,t.magnitude<0&&(t.magnitude=0)),o(e)}),i.quake=t}function Vt(i,t){for(var e in t)i[e]=t[e]}function pt(i){var t={ready:0,total:0,errors:0};Vt(t,R);var e={status:t,images:{},audio:{},loadImage:o,loadAudio:n};function o(m,g){var v=this,b=document.getElementById("image_"+m);return b?(v.images[m]=b,g(null,b)):(b=new Image,b.src="assets/"+m+".png",b.onload=function(){v.images[m]=b,g(null,b)},b.onerror=function(){g("Could not load image "+m)},b)}function n(m,g){var v=this,b=!1,P=10,j=0,y=document.getElementById("audio_"+m);if(y)return v.audio[m]=y,g(null,y);y=new Audio("assets/"+m+".wav");try{y.addEventListener("canplaythrough",L,!1)}catch(M){console.error(M)}function _(){if(!b){if(j>5e3)return g("Could not load audio "+m);y.readyState?L():(j+=P,setTimeout(_,P))}}function L(){y.removeEventListener("canplaythrough",L),b=!0,v.audio[m]=y,g(null,y)}_()}var c=!1,u=null;return Ct(e,i,m=>{m&&console.error(m),c=!0,u&&u()}),function(m,g){if(m.resources=e,!c)return u=g,g}}function Ct(i,t,e){var o=this,n=i.status;function c(g,v){!t[g]||t[g].forEach(b=>{n.total++,v.call(i,b,u)})}c("images",i.loadImage),c("audio",i.loadAudio);function u(g){g?(n.errors++,n.emit("changed"),m()):(n.ready++,n.emit("changed"),m())}function m(){n.total<=n.ready+n.errors&&(n.errors>0?e("Not all resources were loaded"):e())}}var vt=class{constructor({game:t,debug:e}){this.game=t,this.update=this.update.bind(this),this.draw=this.draw.bind(this),t.objects.lists.touchable=t.objects.createIndexList("touchable"),t.chains.update.insertBefore(this.update,t.chains.update.objects),e&&t.chains.draw.push(this.draw)}update(t,e){e(t);for(let o of this.game.objects.lists.touchable){for(let n of this.game.objects.lists.touchable)this.detectTouch(o,n);if(o.touching.size)for(let n of o.touching)this.detectTouch(o,n)}}detectTouch(t,e){if(t!==e){var o=t._objectmanager&&e._objectmanager&&t.position.distanceToV(e.position)<=t.touchRadius+e.touchRadius;this.handleTouch(t,e,o),this.handleTouch(e,t,o)}}handleTouch(t,e,o){t.touching||(t.touching=new Set);var n=t.touching.has(e);o!==n&&(o?(t.touching.add(e),t.touch&&t.touch(e)):(t.touching.delete(e),t.untouch&&t.untouch(e)))}draw(t,e){e(t);for(let o of this.game.objects.lists.touchable)t.strokeStyle("red"),t.strokeCircle(o.position.x,o.position.y,o.touchRadius)}},yt=vt;var xt=class extends w{constructor({game:t}){super(0,0);h(this,"zoom",1);h(this,"worldWidth",2048);this.game=t,this.draw=this.draw.bind(this),this.game.chains.draw.camera=this.draw,this.game.chains.draw.insertBefore(this.draw,this.game.chains.draw.objects)}screenToWorld(t,e){var o=this.getPixelsPerMeter();e.x=(t.x-this.game.width*.5)/o+this.game.camera.x,e.y=(t.y-this.game.height*.5)/o+this.game.camera.y}getPixelsPerMeter(){let t=this.worldWidth;return this.game.width/t/this.game.camera.zoom}reset(){this.x=0,this.y=0}draw(t,e){var o=this.getPixelsPerMeter();t.fillStyle("white"),t.fillRectangle(0,0,this.game.width,this.game.height),t.save(),t.context.scale(o,o),t.context.lineWidth/=o,t.context.translate(this.game.width/o*.5,this.game.height/o*.5),t.context.translate(this.x,-this.y),e(t),t.restore()}},wt=xt;var gt=class{constructor({game:t}){this.game=t,this.reload=this.reload.bind(this),this.mousemove=this.mousemove.bind(this),this.keydown=this.keydown.bind(this),this.draw=this.draw.bind(this)}enable(){this.timeout=setTimeout(this.reload,3e3),this.game.once("keydown",this.keydown),this.game.once("mousemove",this.mousemove),this.game.chains.draw.unshift(this.draw)}reload(){document.location.reload(!0)}keydown(){this.disable()}mousemove(){this.disable()}draw(t,e){e(t),t.fillStyle("#ff0000"),t.fillCircle(this.game.width,0,30),t.fillStyle("black")}disable(){clearTimeout(this.timeout),game.chains.draw.remove(this.draw)}},bt=gt;var Pt=class extends w{constructor({game:t}){super(0,0);h(this,"over",!1);h(this,"buttons",{});this.game=t,this.mouseup=this.mouseup.bind(this),this.mousedown=this.mousedown.bind(this),this.mousemove=this.mousemove.bind(this),this.mousewheel=this.mousewheel.bind(this),this.DOMMouseScroll=this.DOMMouseScroll.bind(this),this.game.canvas.addEventListener("pointerup",this.mouseup,!0),this.game.canvas.addEventListener("pointerdown",this.mousedown,!0),this.game.canvas.addEventListener("pointermove",this.mousemove,!0),this.game.canvas.addEventListener("mousewheel",this.mousewheel,!0),this.game.canvas.addEventListener("DOMMouseScroll",this.DOMMouseScroll,!0)}getMousePosition(t){let e=this.game.canvas.getBoundingClientRect();return new w(t.pageX-e.x,t.pageY-e.y)}mouseup(t){return this.game.mouse.buttons[t.button]&&(this.setV(this.getMousePosition(t)),delete this.buttons[t.button],this.game.emit("mouseup",t.button,this.x,this.y)),!1}mousedown(t){return this.buttons[t.button]||(this.setV(this.getMousePosition(t)),this.buttons[t.button]=!0,this.game.emit("mousedown",t.button,this.x,this.y)),!1}mousemove(t){this.setV(this.getMousePosition(t)),this.game.emit("mousemove",this.x,this.y)}mousewheel(t){this.setV(this.getMousePosition(t)),this.game.emit("mousewheel",t.deltaY,this.x,this.y)}DOMMouseScroll(t){this.setV(this.getMousePosition(t)),this.game.emit("mousewheel",-t.detail)}},jt=Pt;"use strict";var Mt=class{constructor({game:t,items:e,gameplayState:o}){h(this,"items",[]);h(this,"item",null);this.game=t,this.items=e,this.item=e[0],this.gameplayState=o,this.draw=this.draw.bind(this),this.mousedown=this.mousedown.bind(this),this.keydown=this.keydown.bind(this),this.update=this.update.bind(this)}enable(){console.log("enable editor"),this.game.levelSystem.restartLevel(),this.game.chains.draw.push(this.draw),this.game.on("mousedown",this.mousedown),this.game.on("keydown",this.keydown),this.game.chains.update.unshift(this.update)}disable(){console.log("disable editor"),this.game.chains.draw.remove(this.draw),this.game.removeListener("mousedown",this.mousedown),this.game.removeListener("keydown",this.keydown),this.game.chains.update.remove(this.update)}update(t,e){let o=new w((this.game.keys.right?1:0)-(this.game.keys.left?1:0),(this.game.keys.down?1:0)-(this.game.keys.up?1:0));this.game.camera.y+=o.y*t*2e3,this.game.objects.handlePending()}getPosition(){var t=new w;return this.game.camera.screenToWorld(this.game.mouse,t),t.x=Math.round(t.x),t.y=Math.round(t.y),t}place(){var t=this.getPosition();this.game.objects.add(new this.item({x:t.x,y:t.y}))}deleteItem(){let t=this.getPosition(),e=[...this.game.objects.lists.export].reduce((o,n)=>!n||t.distanceToV(n.position)<t.distanceToV(o.position)?n:o);this.game.objects.remove(e)}save(){let t=[...this.game.objects.lists.export].map(({constructor:e,position:o})=>`new ${e.name}({ x: ${o.x}, y: ${o.y}}),`).join(`
`);window.navigator.clipboard.writeText(t).then(()=>{console.log("level copied to clipboard")})}mousedown(t){t===0?this.place():t===2&&this.deleteItem()}play(){let t=[...this.game.objects.lists.export].map(o=>({constructor:o.constructor,x:o.position.x,y:o.position.y}));function e(){return{name:"level",objects:t.map(({constructor:o,x:n,y:c})=>new o({x:n,y:c})),clone:e,nextLevel:e}}this.game.levelSystem.changeLevel(e()),this.game.changeState(this.gameplayState)}keydown(t){t==="p"?this.save():t==="e"?this.play():t==="r"?this.game.levelSystem.restartLevel():t==="d"&&this.deleteItem();var e=(t==="]"?1:0)-(t==="["?1:0);this.item=this.items[(this.items.indexOf(this.item)+e+this.items.length)%this.items.length]}draw(t,e){e(t);for(let u of this.game.objects.lists.editorVisible)u.drawForeground(t);let o=new w;this.game.camera.screenToWorld(w.zero,o);let n=new w;this.game.camera.screenToWorld(new w(this.game.width,this.game.height),n),o.x=Math.floor(o.x),o.y=Math.floor(o.y),n.x=Math.ceil(n.x),n.y=Math.ceil(n.y),t.context.globalAlpha=.1,t.strokeStyle("black"),t.context.globalAlpha=1;var c=this.getPosition();if(t.fillStyle("black"),t.fillCircle(c.x,c.y,.1),this.item){t.context.globalAlpha=.5;let u=new this.item({x:c.x,y:c.y});u.drawBackground&&u.drawBackground(t),u.drawForeground&&u.drawForeground(t),t.context.globalAlpha=1}}},Lt=Mt;"use strict";var Ot={audio:["test","ambient","sploosh","fish_dead","sonar_2","treasure_found"],images:["test","clown","submarine","octopus_0","octopus_1","octopus_2","football","treasure","treasure_closed","seahorse","bubbles","lost","won","background","background_2","air","begin","end","starfish","jelly","white_bubble","splash_1","splash_2","splash_3","splash_4","splash_5"]},f,a;tt.once("load",()=>{var i=document.getElementById("main");a=f=new at(Bt,i,[ut,pt(Ot),ht,dt,ft]),a.mouse=new jt({game:a}),f.resources.status.on("changed",()=>{f.graphics.context.clearRect(0,0,a.width,a.height),f.graphics.context.fillStyle="black",f.graphics.context.font="arial",f.graphics.fillCenteredText(`Preloading ${f.resources.status.ready} / ${f.resources.status.total}...`,400,300)})});function Bt(i){i&&console.error(i);var t=f.resources.images;f.objects.lists.collidable=f.objects.createIndexList("collidable"),f.objects.lists.start=f.objects.createIndexList("start"),f.objects.lists.shadow=f.objects.createIndexList("shadow"),f.objects.lists.background=f.objects.createIndexList("background"),f.objects.lists.foreground=f.objects.createIndexList("foreground"),f.objects.lists.grounded=f.objects.createIndexList("grounded"),f.objects.lists.export=f.objects.createIndexList("export"),f.objects.lists.end=f.objects.createIndexList("end"),f.objects.lists.editorVisible=f.objects.createIndexList("editorVisible"),f.objects.lists.player=f.objects.createIndexList("player"),a.autoRefresh=new bt({game:a}),a.camera=new wt({game:a}),a.touchSystem=new yt({game:a,debug:!1}),a.levelSystem=new ct({game:a});function e(d,s,r=0){let l=a.height/a.camera.getPixelsPerMeter(),p=a.camera.y-l*.5,S=a.camera.y+l*.5,E=(Math.floor(p/s.height)-1)*s.height+r%s.height;for(let T=E;T<=S;T+=s.height)d.context.drawImage(s,0,T)}a.chains.draw.push((d,s)=>{d.save(),d.context.translate(-1024,0),d.context.fillStyle="#0fb0fe",d.context.fillRect(0,a.camera.y-a.height/a.camera.getPixelsPerMeter()*.5,2048,a.height/a.camera.getPixelsPerMeter()),e(d,t.background_2),e(d,t.bubbles,a.time*-200),d.drawCenteredImage(t.air,1024,-t.air.height/2+64),d.restore(),s(d)}),function(){a.chains.draw.push((d,s)=>{for(let r of a.objects.lists.background)r.drawBackground(d);for(let r of a.objects.lists.foreground)r.drawForeground(d);s(d)})}();let o=0;a.resources.audio.ambient.volume=0,a.chains.update.unshift((d,s)=>{_t({audio:a.resources.audio.ambient,target:o,speed:1/10*d}),s(d)});class n{constructor({x:s,y:r}){this.position=new w(s,r)}}class c extends n{constructor(){super(...arguments);h(this,"start",!0);h(this,"export",!0);h(this,"editorVisible",!0)}drawForeground(s){s.drawCenteredImage(t.test,this.position.x,this.position.y)}}class u extends n{constructor({x:s,y:r}){super({x:s,y:r});h(this,"updatable",!0);h(this,"touchable",!0);h(this,"foreground",!0);h(this,"touchable",!0);h(this,"player",!0);h(this,"targetPosition",new w(0,0));h(this,"lifeTime",0);h(this,"sinkRate",200);h(this,"maxSpeed",500);h(this,"touchRadius",150);h(this,"slowStartTime",5);this.image=t.submarine,this.velocity=new w(0,0),this.flipped=!1}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(this.flipped?-1:1,1),s.drawCenteredImage(this.image,0,0),s.restore()}update(s){this.lifeTime+=s;let r=Math.min(this.lifeTime/this.slowStartTime,1),l=this.targetPosition.x-this.position.x,p=Math.sign(l),E=Math.abs(l)>50,T=E?this.maxSpeed:0;this.flipped=E?p<0:this.flipped,this.velocity.x=this.velocity.x*.9+p*T*.1,this.velocity.y=this.sinkRate,this.position.addV(this.velocity.clone().multiply(s*r))}touch(s){s instanceof b&&a.changeState(new kt)}}function m(d){return d*(Math.PI/180)}class g{constructor(s,r,l,p){this.top=s,this.right=r,this.bottom=l,this.left=p,s>0&&console.error("top should be negative of zero"),p>0&&console.error("left should be negative of zero"),l<0&&console.error("bottom should be positive of zero"),r<0&&console.error("right should be positive of zero")}}class v extends n{constructor(){super(...arguments);h(this,"updatable",!0);h(this,"background",!0);h(this,"lifetime",0);h(this,"framerate",1/30);h(this,"images",[a.resources.images.splash_1,a.resources.images.splash_2,a.resources.images.splash_3,a.resources.images.splash_4,a.resources.images.splash_5])}update(s){this.lifetime+=s,this.lifetime>t.length*this.framerate&&a.objects.remove(this)}drawBackground(s){let r=this.framerate*this.images.length,l=this.images[Math.floor(this.lifetime/this.framerate)];s.context.globalAlpha=1-this.lifetime/r,s.drawCenteredImage(l,this.position.x,this.position.y-600),s.context.globalAlpha=1}}class b extends n{constructor({x:s,y:r,angle:l,speed:p,image:S=t.fish,top:E=0,right:T=500,bottom:B=0,left:It=-500}){super({x:s,y:r});h(this,"updatable",!0);h(this,"foreground",!0);h(this,"touchable",!0);h(this,"export",!0);h(this,"touchRadius",100);this.startPosition=new w(s,r),this.relativePosition=new w(0,0),this.image=S,this.size={width:1,height:1},this.boundaries=new g(E,T,B,It),this.speed=p,this.velocity=this.angleAndSpeedtoVector(l,p)}angleAndSpeedtoVector(s,r){let l=Math.sin(m(s))*r,p=Math.cos(m(s))*r;return new w(p,l)}update(s){let r=this.velocity.clone();this.relativePosition.addV(r.multiply(s)),(this.relativePosition.x>this.boundaries.right||this.relativePosition.x<this.boundaries.left)&&(this.velocity.x*=-1),this.position=this.startPosition.clone().addV(this.relativePosition)}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(this.velocity.x<0?1:-1,1),s.drawCenteredImage(this.image,0,0),s.restore()}}class P extends b{constructor(s){super({image:t.clown,...s})}}class j extends b{constructor({x:s,y:r,angle:l,speed:p}){super({x:s,y:r,image:t.football,angle:l!=null?l:45,speed:p!=null?p:200,top:-100,bottom:100,left:-800,right:800})}update(s){let r=this.velocity.clone();this.relativePosition.addV(r.multiply(s)),(this.relativePosition.x>this.boundaries.right||this.relativePosition.x<this.boundaries.left)&&(this.velocity.x*=-1),(this.relativePosition.y<this.boundaries.top||this.relativePosition.y>this.boundaries.bottom)&&(this.velocity.y*=-1),this.position=this.startPosition.clone().addV(this.relativePosition)}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(this.velocity.x<0?1:-1,1),s.context.rotate(this.velocity.x<0?this.velocity.angle()+Math.PI:this.velocity.angle()*-1),s.drawCenteredImage(this.image,0,0),s.restore()}}class y extends b{constructor({x:s,y:r,angle:l,speed:p,top:S,right:E,bottom:T,left:B}){super({x:s,y:r,image:t.octopus_0,angle:l!=null?l:15,speed:p!=null?p:300,top:S!=null?S:-200,right:E!=null?E:200,bottom:T!=null?T:200,left:B!=null?B:-200});this.frame=0}update(s){this.frame+=s*2,this.image=t[`octopus_${Math.round(this.frame)%3}`];let r=this.velocity.clone();this.relativePosition.addV(r.multiply(s)),(this.relativePosition.x>this.boundaries.right||this.relativePosition.x<this.boundaries.left)&&(this.velocity.x*=-1),(this.relativePosition.y<this.boundaries.top||this.relativePosition.y>this.boundaries.bottom)&&(this.velocity.y*=-1),this.position=this.startPosition.clone().addV(this.relativePosition)}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(this.velocity.x<0?-1:1,1),s.drawCenteredImage(this.image,0,0),s.restore()}}class _ extends b{constructor({x:s,y:r,angle:l,speed:p}){super({x:s,y:r,image:t.seahorse,angle:l!=null?l:0,speed:p!=null?p:200,top:0,right:1200-s+10,bottom:0,left:-1200-s-10})}update(s){let r=this.velocity.clone();this.relativePosition.addV(r.multiply(s)),this.relativePosition.x>this.boundaries.right&&(this.relativePosition.x=this.boundaries.left),this.position=this.startPosition.clone().addV(this.relativePosition)}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(1,1),s.drawCenteredImage(this.image,0,0),s.restore()}}class L extends n{constructor(...s){super(...s);h(this,"touchable",!0);h(this,"updatable",!0);h(this,"foreground",!0);h(this,"touchRadius",100);h(this,"patrolInterval",4);h(this,"waveInterval",2);h(this,"phase",300);h(this,"speed",300);this.velocity=new w(0,0),this.lifetime=0,this.direction=1}update(s){this.lifetime+=s,this.direction=(Math.floor(this.lifetime/this.patrolInterval)%2-.5)*2,this.velocity=w.xaxis.clone().rotate(Math.sin(this.lifetime*(Math.PI*2)/this.waveInterval)),this.velocity.x*=this.speed*this.direction,this.velocity.y*=this.phase*this.direction,this.position.addV(this.velocity.clone().multiply(s))}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.rotate(this.velocity.angle()),s.context.scale(this.direction,this.direction),s.drawCenteredImage(t.jelly,0,0),s.restore()}}class M extends b{constructor({x:s,y:r,angle:l,speed:p}){super({x:s,y:r,image:t.starfish,angle:l!=null?l:0,speed:p!=null?p:200,top:0,right:1024-s+10,bottom:0,left:-1024-s-10})}update(s){let r=this.velocity.clone();this.relativePosition.addV(r.multiply(s)),this.relativePosition.x>this.boundaries.right&&(this.relativePosition.x=this.boundaries.left),this.position=this.startPosition.clone().addV(this.relativePosition)}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(1,1),s.context.rotate(m(360/(this.speed-(this.boundaries.right-Math.abs(this.relativePosition.x)))*this.relativePosition.x)),s.drawCenteredImage(this.image,0,0),s.restore()}}class A extends n{constructor({x:s,y:r}){super({x:s,y:r});h(this,"updatable",!0);h(this,"foreground",!0);this.velocity=new w(0,-(300+300*Math.random())),this.period=8+Math.random()*4,this.lifetime=Math.random()*this.period,this.scale=.5*Math.random()+.5}update(s){this.lifetime+=s,this.velocity.x=Math.sin(this.lifetime/(Math.PI*2)*this.period)*100,this.velocity.y-=500*s,this.position.addV(this.velocity.clone().multiply(s))}drawForeground(s){s.save(),s.context.translate(this.position.x,this.position.y),s.context.scale(this.scale,this.scale),s.drawCenteredImage(t.white_bubble,0,0),s.restore()}}class O extends n{constructor({y:s}){super({x:0,y:s});h(this,"end",!0);h(this,"export",!0);h(this,"background",!0);this.image=t.treasure_closed}get bottom(){return this.position.y+this.image.height*.5}drawBackground(s){s.drawCenteredImage(this.image,this.position.x,this.position.y)}open(){this.image=t.treasure;let s=this.position.x+(1105-1024),r=this.position.x+(1555-1024),l=this.position.y+(1400-1024);for(let p=s;p<r;p+=20){let S=new A({x:p,y:l});a.objects.add(S)}}}function St({current:d,target:s,speed:r}){let l=s-d,p=Math.sign(l),S=Math.abs(l);return r>S?s:d+p*r}function _t({audio:d,target:s,speed:r}){let l=St({current:d.volume,target:s,speed:r});d.volume=l}class N{constructor({game:s}){this.game=s,this.update=this.update.bind(this)}enable(){this.game.camera.reset(),this.game.chains.update.unshift(this.update),this.player=new u({x:0,y:-2048}),this.game.objects.add(this.player),this.game.objects.handlePending()}disable(){this.game.chains.update.remove(this.update)}update(s,r){this.player.velocity.y+=2048*s,this.player.position.y+=this.player.velocity.y*s,this.player.position.y>0&&(this.player.velocity.set(0,0),this.game.resources.audio.sploosh.play(),this.game.objects.add(new v({x:this.player.position.x,y:this.player.position.y})),this.game.changeState(new Tt({game:this.game,player:this.player})))}}class Tt{constructor({game:s,player:r}){this.game=s,this.player=r,this.update=this.update.bind(this),this.keydown=this.keydown.bind(this),this.pingtime=Math.floor(Math.random()*15)}enable(){this.game.camera.reset(),this.game.chains.update.push(this.update),this.game.on("keydown",this.keydown),a.resources.audio.ambient.loop=!0,a.resources.audio.ambient.volume=0,a.resources.audio.ambient.play(),o=1}disable(){o=0,this.game.chains.update.remove(this.update),this.game.removeListener("keydown",this.keydown)}keydown(s){if(s==="r"){this.game.levelSystem.restartLevel();return}else if(s==="n"){this.game.levelSystem.nextLevel();return}else if(s==="m"){this.game.levelSystem.changeLevel(G());return}else s==="e"?this.game.changeState(new Lt({game:a,gameplayState:this,items:[c,P,y,j,O]})):s==="9"?this.player.position.y=this.game.objects.lists.end.first.position.y-200:s==="0"&&this.game.changeState(new Y({game:a}));let r=new w((s==="right"?1:0)-(s==="left"?1:0),(s==="down"?1:0)-(s==="up"?1:0));this.player.movement=r}update(s){this.pingtime-=s,this.pingtime<0&&(a.resources.audio.sonar_2.play(),this.pingtime=Math.floor(Math.random()*15)),this.game.camera.screenToWorld(this.game.mouse,this.player.targetPosition);let r=[...this.game.objects.lists.end][0];this.game.camera.y=Math.min(this.player.position.y,r.bottom-this.game.height*.5/this.game.camera.getPixelsPerMeter()),this.player.position.y>r.position.y&&(r.open(),this.game.resources.audio.treasure_found.play(),this.player.sinkRate=0,this.game.changeState(this.game.levelSystem.hasNextLevel()?new Et({game:a}):new Y({game:a})))}}class U{constructor({game:s}){this.game=s,this.draw=this.draw.bind(this),this.mousedown=this.mousedown.bind(this)}enable(){this.game.camera.reset(),this.game.levelSystem.changeLevel(null),this.game.chains.draw.push(this.draw),this.game.on("mousedown",this.mousedown)}disable(){this.game.chains.draw.remove(this.draw),this.game.removeListener("mousedown",this.mousedown)}mousedown(){this.game.levelSystem.changeLevel(G()),this.game.changeState(new N({game:this.game}))}draw(s,r){r(s),s.drawCenteredImage(t.begin,0,a.camera.y+1e3)}}class Y{constructor({game:s}){h(this,"lifetime",0);this.game=s,this.draw=this.draw.bind(this),this.update=this.update.bind(this),this.mousedown=this.mousedown.bind(this)}enable(){this.game.chains.draw.push(this.draw),this.game.chains.update.unshift(this.update),this.game.on("mousedown",this.mousedown)}disable(){this.game.chains.draw.remove(this.draw),this.game.chains.update.remove(this.update),this.game.removeListener("mousedown",this.mousedown)}mousedown(){this.lifetime<2||this.game.changeState(new U({game:this.game}))}draw(s,r){r(s);let l=1,p=3;s.context.globalAlpha=Math.max(0,Math.min(this.lifetime-l,p)/p),s.drawCenteredImage(t.end,0,a.camera.y-1e3),s.context.globalAlpha=1}update(s,r){let l=this.lifetime+=s,p=3,S=1-Math.min(l,p)/p;r(S*s)}}function G(){return{name:"Level 1",objects:[new P({x:300,y:800,angle:180,speed:300,top:0,right:200,bottom:0,left:-500}),new P({x:80,y:3e3,angle:180,speed:300,top:0,right:500,bottom:0,left:-500}),new P({x:160,y:2800,angle:180,speed:320,top:0,right:500,bottom:0,left:-500}),new P({x:80,y:2600,angle:180,speed:300,top:0,right:500,bottom:0,left:-500}),new P({x:-20,y:4600,angle:0,speed:300,top:0,right:500,bottom:0,left:-500}),new P({x:60,y:4400,angle:0,speed:320,top:0,right:500,bottom:0,left:-500}),new P({x:-20,y:4200,angle:0,speed:300,top:0,right:500,bottom:0,left:-500}),new O({x:0,y:6e3})],clone:G,nextLevel:Z}}function Z(){return{name:"Level 2",objects:[new L({x:500,y:1e3}),new y({x:60,y:2e3}),new j({x:80,y:3e3}),new _({x:200,y:4e3}),new M({x:80,y:5e3}),new O({x:0,y:5500})],clone:Z,nextLevel:J}}function J(){return{name:"Level 3",objects:[new O({x:-24,y:6512}),new _({x:790,y:5710}),new _({x:-653,y:5275}),new j({x:441,y:3797}),new j({x:627,y:4022}),new j({x:-459,y:2813,angle:315}),new j({x:-699,y:3077,angle:315}),new y({x:674,y:1500,top:-400,right:400,bottom:400,left:-400}),new y({x:-521,y:1e3,angle:345})],clone:J,nextLevel:X}}function X(){return{name:"Level 4",objects:[new O({x:-200,y:10352}),new y({x:588,y:9610,angle:330,speed:600,top:-400,right:400,bottom:400,left:-400}),new y({x:-235,y:9285}),new L({x:-290,y:7976}),new M({x:10,y:7871}),new j({x:-176,y:7604}),new M({x:540,y:7335,speed:400}),new M({x:-625,y:5994}),new _({x:660,y:5058,speed:350}),new y({x:-706,y:4101,top:-400,right:400,bottom:400,left:-400}),new y({x:806,y:3805,top:-400,right:400,bottom:400,left:-400}),new L({x:883,y:2128}),new L({x:383,y:2768}),new L({x:-396,y:2128}),new M({x:355,y:1481}),new M({x:-777,y:875}),new M({x:777,y:875})],clone:X,nextLevel:null}}class Et{constructor(){this.draw=this.draw.bind(this),this.mousedown=this.mousedown.bind(this),this.update=this.update.bind(this)}enable(){f.chains.draw.unshift(this.draw),f.chains.update.unshift(this.update),f.on("mousedown",this.mousedown)}disable(){f.chains.draw.remove(this.draw),f.chains.update.remove(this.update),f.removeListener("mousedown",this.mousedown)}draw(s,r){r(s),s.save(),s.context.translate(a.width*.5,a.height*.5);let l=a.camera.getPixelsPerMeter();s.context.scale(l,l),s.drawCenteredImage(t.won,0,0),s.restore()}mousedown(){a.levelSystem.nextLevel(),a.changeState(new N({game:a}))}update(s,r){r(s)}}class kt{constructor(){this.draw=this.draw.bind(this),this.mousedown=this.mousedown.bind(this),this.update=this.update.bind(this)}enable(){f.chains.draw.unshift(this.draw),f.chains.update.insertBefore(this.update,a.chains.update.objects),f.on("mousedown",this.mousedown),a.resources.audio.fish_dead.play()}disable(){f.chains.draw.remove(this.draw),f.chains.update.remove(this.update),f.removeListener("mousedown",this.mousedown)}draw(s,r){r(s),s.save(),s.context.translate(a.width*.5,a.height*.5);let l=a.camera.getPixelsPerMeter();s.context.scale(l,l),s.drawCenteredImage(t.lost,0,0),s.restore()}mousedown(){a.levelSystem.restartLevel(),a.changeState(new N({game:a}))}update(s,r){}}a.changeState(new U({game:a})),a.start(),window.game=a}})();
//# sourceMappingURL=main.js.map
